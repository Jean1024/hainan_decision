$(function(){function t(){var t='"'+[].join.call(arguments,'","')+'"';return t=t.replace(/\\/g,"\\\\"),t=t.replace(/"true"/g,!0).replace(/"false"/g,!1),"javascript:Util.invoke("+t+")"}function n(t,n){var i=u.exec(t),e="";return i&&(e=t.replace(i[0],"_"+n+i[3])),e.replace("_0","")}function i(t){return"wisp://pImg.wi?url="+t+"&"}function e(){$(".c_list,.c_content").remove()}function a(i,a){o.canBack(!1);var c=function(t){return""!==t&&!isNaN(t)};s=i,d.show(),f(i,function(a){e();var r=a.type,s=a.desc,l='<div class="c_list">'+(s?'<p class="desc">'+s+"</p>":"")+"<ul>";a&&a.l.length>0?$.each(a.l,function(n,i){var e=i.url,a=i.img,c=i.title,s=i.time,o=i.fontColor;l+="<li>"+(a?'<img class="c_list_img" src="'+a+'"/>':"")+"<a "+(o?'style="color:'+o+'"':"")+" href='"+("pdf"==r?h(e,c):t("initContent",e,!0))+"'>"+c+"</a><span>"+s+"</span></li>"}):l+="<li>暂无"+("alarm"==r?"预警":"数据")+"</li>",l+="</ul>";var o=a.prev,v=a.next,f=c(o),u=c(v);(f||u)&&(l+='<div class="pager">',l+='<div class="btn_pager">',f&&(l+='<a class="btn btn_prev" href=\''+t("initList",n(i,o))+"'>上一页</a>"),l+='</div><div class="btn_pager">',u&&(l+='<a class="btn btn_next" href=\''+t("initList",n(i,v))+"'>下一页</a>"),l+="</div></div>"),l+="</div>",$(l).appendTo(g),d.hide()},{format:function(t){if(t)if("count"in t&&"data"in t){var n={type:"alarm"},i=[];$.each(t.data,function(t,n){n=p(n),i.push(n)}),n.l=i,t=n}else $.each(t.l,function(n,i){t.l[n]={url:i.l2,img:i.l4,title:i.l1,time:i.l3,fontColor:i.l6}});return t},no_cache:a})}function c(t){var n=t.type;if("jcbw"==n){var e=$("<div>").html(t.c7);e.find("img").wrap(function(){var t=$(this),n=t.parent();return n.is('p[style="text-indent:2em;"]')&&t.next().is("br")&&n.css("text-indent",0),$('<a class="img">').attr("href",i($(this).attr("src")))}),t.c7=e.html(),t.c1||(t.c1=""),t={type:"jcbw",org:t.c3,title:t.c1,time:t.c4,content:t.c7}}else if("tw"==n);else if("ALERTID"in t){var a={type:"alarm"},c=a.org=t.PROVINCE+t.CITY+"气象台";a.title=c+"发布"+t.SIGNALTYPE+t.SIGNALLEVEL+"预警",a.time=t.RELIEVETIME,a.content="<p>"+t.ISSUECONTENT+"</p>",t=a}return t}function r(n,a,v){var u=this.no_cache;if(d.show(),"string"==typeof n)f(n,function(t){r(t,a,v),l=n},{format:c,no_cache:u});else{var p=n;e();var h=p.type;if("tw"==h){var _=p.c1,m='<div class="c_content '+h+'">';if(_){var w=p.c3;m+='<div class="c_title"><h2>'+p.c1+"</h2>"+(w?'<span class="fr">'+w+"</span>":"")+"</div>"}m+='<div class="c_text">'+p.c2+'</div><span class="c_copyright">'+p.c5+"</span>"}else if("multipleimg"==h){var m='<div class="c_content '+h+'"><div class="c_text"><ul class="c_img_list">';$.each(p.imgs,function(t,n){m+='<li><a class="img" href="'+i(n.i)+'"><img src="'+n.i+'"/><span class="img_desc">'+n.n+"</span></a></li>"}),m+="</ul></div></div>"}else if("jcbw"==h||"alarm"==h)var m='<div class="c_content '+h+'"><div class="c_title c_f_red"><h2>'+p.title+'</h2><div class="c_postil"><span class="fl">'+p.org+'</span><span class="fr">'+p.time+'</span></div></div><div class="c_text">'+p.content+"</div></div>";else if("table"==h){var b=p.title,y=p.rows;if($.isArray(y)&&$.isArray(b)){var T=p.width;if(!T){T=[];for(var k=p.title.length,I=100/k+"%",L=0;k>L;L++)T[L]=I}var w=p.time,E="";w&&(E='<div class="data_time">'+w+"</div>");var m='<div class="c_content '+h+'">'+E+"<table>",x=[b].concat(y);$.each(x,function(t,n){m+="<tr>",$.each(n,function(t,n){m+='<td width="'+T[t]+'">'+n+"</td>"}),m+="</tr>"}),m+="</table></div>"}}if(m){var C,N,S,j=$(m);a&&s&&(C=t("initList",s),N="initList",S=s),v&&l&&(C=t("initContent",l),N="initContent",S=l),C?(o.canBack(!0),j.append('<a class="btn_back_list btn" href=\''+C+"' data-fn=\""+N+'" data-url="'+S+'">返回</a>')):o.canBack(!1),j.appendTo(g)}d.hide()}}var s,l,o=Util,v=o.Nav,f=o.getJson,d=o.Loading,u=/(_(\d{1,2}))?(\.\w+$)/,p=function(){var t=["台风","暴雨","暴雪","寒潮","大风","沙尘暴","高温","干旱","雷电","冰雹","霜冻","大雾","霾","道路结冰"],n=["寒冷","灰霾","雷雨大风","森林火险","降温","道路冰雪","干热风","低温","冰冻"],i=["蓝色","黄色","橙色","红色"],e=["白色"],a=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})-(\d{2})(\d{2})\.html/;return function(c){var r=a.exec(c[1]),s={};if(r){var l=parseInt(r[7],10),o="";o=l>90?n[l-91]:t[l-1];var v="",f=parseInt(r[8],10);v=f>90?e[f-91]:i[f-1];var d="";d=v>90||l>90?"0000":r[7]+r[8],s.title=c[0]+"气象台发布"+o+v+"预警",s.time=r[1]+"-"+r[2]+"-"+r[3]+" "+r[4]+":"+r[5]+":"+r[6],s.img="./img/waring/icon_warning_"+d+".png",s.url="http://www.weather.com.cn/data/alarm/"+c[1]}return s}}(),g=$(".content");g.delegate("a","click",function(){return parseFloat($(".nav_left").css("left"))?!1:!0});var h=function(){var n=encodeURIComponent;return window.nwDispatcher?function(){function i(t,i){var c=a[t];if(c)c.focus();else{var r=e.open("pdf/view.html?file="+n(t)+"&title="+n(i));r.on("close",function(){delete a[t],r.close(!0)}),a[t]=r}}var e=require("nw.gui").Window,a={};return e.get().on("close",function(){for(var t in a)a[t].close();this.close(!0)}),o.invoke.reg("_openPDF",i),function(n,i){return t("_openPDF",n,i)}}():function(t,i){return"wisp://pPdf.wi?title="+n(i)+"&injectedObjectSrc="+t}}();o.invoke.reg("initList",a),o.invoke.reg("initContent",r);var _=function(t){return/^http:\/\/.+/.test(t)};!function(){var t,n=0,i=function(t,i){var c=t.l_url,s=t.d_url;n=(new Date).getTime(),c&&_(c)?a(c,i):s&&_(s)?r.call({no_cache:i},s):(e(),$('<div class="c_content">暂无内容</div>').appendTo($(".content")))};$(document).on("init_data",function(n,e){t=e,i(e)}).on("back",function(){if(v.isShow())v.toggle(!0);else{var t=$(".btn_back_list"),n=t.data("fn"),i=t.data("url");o.invoke(n,i)}}).on("restart",function(){console.log("item restart:"+JSON.stringify(t)),t&&(new Date).getTime()-n>3e5&&i(t,!0)})}(),v.Top.init(function(t){$(".container").prepend(t);var n=o.Store.get("c_warning");if(n){o.Store.rm("c_warning"),v.Top.title(n.title);var i=c(n.info);r(i)}},function(){var t=$(".content"),n=$(".nav_top").height()+10;t.css("margin-top",n).height($(window).height()-n)})});